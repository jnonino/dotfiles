name: Test Chezmoi repo

on:
  push:
    branches:
      - main

env:
  GH_USERNAME: jnonino

jobs:
  macos:
    runs-on: macOS-latest
    steps:
      - name: Install brew
        run: /bin/bash -c "$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/HEAD/install.sh)"
      - name: Install Chezmoi
        run: brew install chezmoi
      - name: Configure dotfiles
        run: chezmoi init --apply $GH_USERNAME

  linux:
    runs-on: ubuntu-latest
    steps:
      - name: Install brew dependencies
        run: sudo apt-get install build-essential procps curl file git
      - name: Install brew
        run: /bin/bash -c "$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/HEAD/install.sh)"
      - name: Install Chezmoi
        run: brew install chezmoi
      - name: Configure dotfiles
        run: chezmoi init --apply $GH_USERNAME

  windows:
    runs-on: windows-latest
    steps:
      - name: Install Chezmoi and configure dotfiles
        run: (irm -useb https://get.chezmoi.io/ps1) | powershell -c -
      - name: Configure dotfiles
        run: chezmoi init https://github.com/$GH_USERNAME/dotfiles.git
