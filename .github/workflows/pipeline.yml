name: Test Chezmoi repo

on:
  push:
    branches:
      - main

env:
  GH_USERNAME: jnonino

jobs:
  macos:
    runs-on: macOS-latest
    steps:
      - name: Install and Configure
        run: sh -c "$(curl -fsLS get.chezmoi.io)" -- -b $HOME/bin init --apply $GH_USERNAME

  linux:
    runs-on: ubuntu-latest
    steps:
      - name: Install and Configure
        run: sh -c "$(curl -fsLS get.chezmoi.io)" -- -b $HOME/.local/bin init --apply $GH_USERNAME

  windows:
    runs-on: windows-latest
    steps:
      - name: Install Chezmoi and configure dotfiles
        run: (irm -useb https://get.chezmoi.io/ps1) | powershell -c -
      - name: Configure dotfiles
        run: chezmoi init https://github.com/$GH_USERNAME/dotfiles.git
